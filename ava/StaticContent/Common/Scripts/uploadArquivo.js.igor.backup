function abrirUploadArquivo(a,b,c,d,e,f,g){if(f=="IE"){$("#countt_"+e).html("<img src='/AVA/StaticContent/Common/img/perfil/carregando.gif' border='0' />");$.ajax({type:"POST",url:"/ava/upload/home/uploadIE",data:{idUsuarioRecebe:a,idFerramenta:b,idFerramentaTipo:c,contador:e,bolAluno:g},cache:false,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(a){$("#countt_"+e).html(a);$("#tabs_"+e).tabs();$.getScript("/AVA/StaticContent/Common/Scripts/ajaxfileupload.js",function(){if(d=="false"){$(".etapa_infos").each(function(){$(this).find("#filedrag_"+e).remove();if($.trim($(this).find("#progressbar_"+e).text())==""){$(this).find("#progressbar_"+e).html("<p>Nenhum arquivo enviado.</p>")}else{$(this).find("#progressbar_"+e+" .excludeProgress").remove()}})}})},error:function(){$(".container_inEntrega").html("erro ao carregar container upload.")}})}else{$("#countt_"+e).html("<img src='/AVA/StaticContent/Common/img/perfil/carregando.gif' border='0' />");$.ajax({type:"POST",url:"/ava/upload/",data:{idUsuarioRecebe:a,idFerramenta:b,idFerramentaTipo:c,contador:e},cache:false,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(a){$("#countt_"+e).html(a);$("#tabs_"+e).tabs();$.getScript("/AVA/StaticContent/Common/Scripts/filedrag.js",function(){InitFileDrag(e,g);if(d=="false"){$(".etapa_infos").each(function(){$(this).find("#filedrag_"+e).remove();if($.trim($(this).find("#progressbar_"+e).text())==""){$(this).find("#progressbar_"+e).html("<p>Nenhum arquivo enviado.</p>")}else{$(this).find("#progressbar_"+e+" .excludeProgress").remove()}})}})},error:function(){$(".container_inEntrega").html("erro ao carregar container upload.")}})}}function excluirArquivo(a,b){if(b){$.ajax({type:"POST",url:"/ava/upload/home/Excluir",data:{id:a},cache:false,success:function(b){var c=$("#boxarq_"+a).parent().parent();$("#boxarq_"+a).slideUp("slow",function(){$(this).remove()});var d=c.closest(".etapa_infos").find(".listaEtapas").attr("idEtapa");if(d!=""&&d!==undefined){var e=c.closest(".etapa_infos").find(".listaEtapas").attr("idRotaUsuario");var f=c.closest(".etapa_infos").find(".listaEtapas").attr("idRecurso");var g=c.closest(".etapa_infos").find(".listaEtapas").attr("idRotaAgendamento");var h=c.closest(".etapa_infos").prev().children(":first").attr("idRotaEtapaUsuario");var i=0;c.find(".nome_Arquiv").each(function(){i++});i=i-1;if(i==0){var j=c.closest(".etapa_infos").prev().children(":first").find(".ep_status");j.removeClass("arq_enviado_on").addClass("arq_enviado_off");salvarCaminhoEtapaUsuario(h,e,d,f,g,false,"normal","sim")}}$("#msg_aviso").remove()},error:function(){$("#boxarq_"+a).html("erro ao excluir arquivo.")}})}else{$("#tooltipExc_"+a).css("display","none")}}function ajaxFileUpload(a,b){if($("#fileToUpload_"+a).val()!=""){$("#msg_aviso").remove();var c=$("#idUsuarioRecebe_"+a).val();var d=$("#idFerramenta_"+a).val();var e=$("#idFerramentaTipo_"+a).val();var f=$("#fileToUpload_"+a).val();f=f.split("\\");var g=f.length-1;f=f[g];$("#progressbar_"+a).prepend("<div class='singleProgress'><span class='nome_Arquiv' title='"+f+"'>"+f+"</span>"+"<div class='algumProgresso'></div><span class='percCompleteUpload'> 0%</span> <span class='excludeProgress'>"+"<a href='javascript:void(0);' class='bt_normal red_light b_tooltip_left'>X</a></span></div>");var h=$("#progressbar_"+a+" .singleProgress:first");var i=$("#progressbar_"+a+" .algumProgresso:first");$("#progressbar_"+a+" .algumProgresso:first").progressbar({value:0});$.ajaxFileUpload({url:"/ava/Upload/Home/IniciaUploadIE/?idUsuarioRecebe="+c+"&idFerramentaTipo="+e+"&idFerramenta="+d,secureuri:false,fileElementId:"fileToUpload_"+a,dataType:"json",beforeSend:function(){$("#loading_"+a).show()},complete:function(){$("#loading_"+a).hide()},success:function(c,d){if(typeof c.error!="undefined"){if(c.error=="0"){var e=c.idarquivo;var g=c.msg;var j=$("#idFerramentaTipo_"+a).val();if(j=="15"&&b=="true"){var k=i.closest(".container_entrega_aluno").closest(".etapa_infos");if(k.find(".fecha_X").attr("idrotaagendamento")!=""&&k.find(".fecha_X").attr("idrotaagendamento")!=undefined&&k.find(".fecha_X").attr("idrotaagendamento")!=null){k=k.find(".fecha_X")}else if(k.find(".abrirObraLiteraria").attr("idrotaagendamento")!=""&&k.find(".abrirObraLiteraria").attr("idrotaagendamento")!=undefined&&k.find(".abrirObraLiteraria").attr("idrotaagendamento")!=null){k=k.find(".abrirObraLiteraria")}enviarTrabalhoMarcarConcluido(k)}i.progressbar("option","value",100);i.next().html(" 100%");$("#progressbar_"+a).prepend("<div id='msg_aviso' class='ui-widget'><div class='ui-state-highlight ui-corner-all' style='display:none; margin-top:8px; padding: 0 .7em;'><p><span class='ui-icon ui-icon-alert' style='float: left; margin-right: .3em;'></span><strong>Ok:</strong> Upload do arquivo '"+f+"' realizado com sucesso!</p></div></div>");$(".ui-state-highlight").fadeIn("slow");h.attr("id","boxarq_"+e);h.children("span:last").append('<span class="black_tip_left black_tip_M tooltip" id="tooltipExc_'+e+'">'+"<p>Deseja realmente excluir este arquivo? </p>"+'<a href="javascript: void(0);" class="bt_normal green" onclick="excluirArquivo('+e+', true)">sim</a>'+' <a href="javascript: void(0);" class="bt_normal red" onclick="excluirArquivo('+e+', false)">não</a>'+'<span class="black_tip_seta">&#9660;</span>'+"</span>");$(".b_tooltip_left").each(function(){$(this).tooltip({offset:[0,0],opacity:1,position:"top left",effect:"slide",relative:true,events:{def:"click, mouseout"}})})}else{if(c.error=="1"){var e=c.idarquivo;var g=c.msg;InformationAlertFile($("#fileToUpload_"+a).val(),a)}}}},error:function(a,b,c){alert(c)}})}else{alert("Selecione um arquivo.")}return false}