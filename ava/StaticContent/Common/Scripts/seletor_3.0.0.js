var ajaxJsonDetalharDetalharDestinatarioMensagem = null; function detalharDestinatarioMensagemAjax(a) { var b = null; if (ajaxJsonDetalharDetalharDestinatarioMensagem != null) { ajaxJsonDetalharDetalharDestinatarioMensagem.abort() } ajaxJsonDetalharDetalharDestinatarioMensagem = $.ajax({ url: "/AVA/Seletor/Home/DestinoPostInicio", data: { idMensagem: a }, type: "POST", dataType: "json", async: false, success: function (c) { b = c }, error: function (c) { b = null; console.log("não foi possivel buscar os detalhes") } }); return b } function detalharDestinatarioMensagemLajotinhaAjax(a, b) { var c = null; if (ajaxJsonDetalharDetalharDestinatarioMensagem != null) { ajaxJsonDetalharDetalharDestinatarioMensagem.abort() } ajaxJsonDetalharDetalharDestinatarioMensagem = $.ajax({ url: b ? "/AVA/Seletor/Home/DestinoPostDetalharSeguidores" : "/AVA/Seletor/Home/DestinoPostDetalhar", data: a, type: "POST", dataType: "json", async: false, success: function (d) { c = d }, error: function (d) { c = null } }); return c } function detalharDestinatarioMensagem(b, f) { var d = null; var e = 0; var a = 0; var h = 15; var g = null; var c = null; $.fancybox({ type: "ajax", href: "/AVA/Seletor/Home/modalDestinoPost/", ajax: { type: "POST", data: { idMensagem: b, idFerramentaTipo: f }, dataType: "html" }, scrolling: "no", beforeShow: function () { $("html").css({ overflow: "hidden" }); $.fancybox.showLoading() }, afterShow: function () { var i = ""; switch (f) { case 2: case 4: case 14: case 15: case 17: case 18: case 19: case 25: i = "Agendado para:"; break; default: i = "Compartilhado com:"; break } $("#ava_contentdestinopost_voltar").next().text(i); var j = detalharDestinatarioMensagemAjax(b); if (j != null) { d = $.parseJSON(JSON.stringify(j)); e = d.length; a = 0; g = d.slice(0); c = g.slice(0, h); g.splice(0, h); if (e < h) { a = e } else { a = h } if (e == 0) { $("#ava_contentdestinopost_total").html("<p>Nenhum resultado encontrado</p>") } else { $("#ava_contentdestinopost_total").html("<p>Exibindo " + a + " de " + e + "</p>") } window.setTimeout(function () { $("#myContentTemplateDestinoPost").tmpl({ Result: c }).appendTo("#ava_contentdestinopost"); window.setTimeout(function () { $.fancybox.hideLoading() }, 100) }, 100); $("#ava_contentdestinopost_voltar", $("#ava_contentdestinopost").prev()).on("click", function () { $.fancybox.showLoading(); $(this).hide(); $("#ava_contentdestinopost").prev().removeClass("titulo_modal_interno"); $("#ava_contentdestinopost_voltar", $("#ava_contentdestinopost").prev()).next().text(i); g = d.slice(0); e = g.length; a = 0; c = g.slice(0, h); g.splice(0, h); if (e < h) { a = e } else { a = h } if (e == 0) { $("#ava_contentdestinopost_total").html("<p>Nenhum resultado encontrado</p>") } else { $("#ava_contentdestinopost_total").html("<p>Exibindo " + a + " de " + e + "</p>") } $("#ava_contentdestinopost .carteirinha").remove(); window.setTimeout(function () { $("#myContentTemplateDestinoPost").tmpl({ Result: c }).appendTo("#ava_contentdestinopost"); window.setTimeout(function () { $.fancybox.hideLoading() }, 100) }, 100) }); $("#ava_contentdestinopost").on("click", ".carteirinha.compartilhado_grupo", function () { $.fancybox.showLoading(); var m = i + " "; m += $.trim($(this).find("strong").text()); m += " (" + $.trim($(this).find("span").text()) + ")"; if (m.length > 140) { m = m.substring(0, 140) + "..." } $("#ava_contentdestinopost_voltar", $("#ava_contentdestinopost").prev()).show(); $("#ava_contentdestinopost_voltar", $("#ava_contentdestinopost").prev()).next().text(m); $("#ava_contentdestinopost").prev().addClass("titulo_modal_interno"); var o = parseInt($(this).attr("bolSeguidores")) == 1; var p = {}; if (!o) { var l = parseInt($(this).attr("idEscola")); var k = parseInt($(this).attr("idUnidade")); var n = parseInt($(this).attr("idCurso")); var t = parseInt($(this).attr("idSerie")); var q = parseInt($(this).attr("idTurma")); var s = parseInt($(this).attr("idPapel")); p = { idMensagem: b, idEscola: l, idUnidade: k, idCurso: n, idSerie: t, idTurma: q, idPapel: s} } else { p = { idMensagem: b} } var r = detalharDestinatarioMensagemLajotinhaAjax(p, o); if (r != null) { g = $.parseJSON(JSON.stringify(r)); e = g.length; a = 0; c = g.slice(0, h); g.splice(0, h); if (e < h) { a = e } else { a = h } if (e == 0) { $("#ava_contentdestinopost_total").html("<p>Nenhum resultado encontrado</p>") } else { $("#ava_contentdestinopost_total").html("<p>Exibindo " + a + " de " + e + "</p>") } $("#ava_contentdestinopost .carteirinha").remove(); window.setTimeout(function () { $("#myContentTemplateDestinoPost").tmpl({ Result: c }).appendTo("#ava_contentdestinopost"); window.setTimeout(function () { $.fancybox.hideLoading() }, 100) }, 100) } else { $.fancybox.hideLoading() } }); $(".ava_lightcontent").scroll(function () { if (a < e) { if ($(".ava_lightcontent").get(0).clientHeight + 20 >= ($(".ava_lightcontent").get(0).scrollHeight - $(".ava_lightcontent").get(0).scrollTop)) { c = g.slice(0, h); g.splice(0, h); a += c.length; $("#ava_contentdestinopost_total").html("<p>Exibindo " + a + " de " + e + "</p>"); $("#myContentTemplateDestinoPost").tmpl({ Result: c }).appendTo("#ava_contentdestinopost") } } }) } else { $.fancybox.hideLoading() } }, beforeClose: function () { $.fancybox.hideLoading(); d = null; if (ajaxJsonDetalharDetalharDestinatarioMensagem != null) { ajaxJsonDetalharDetalharDestinatarioMensagem.abort() } ajaxJsonDetalharDetalharDestinatarioMensagem = null }, afterClose: function () { $("html").css({ overflow: "scroll" }) }, autoSize: false, width: 900, height: 530, type: "ajax", autoResize: false, fitToView: false, padding: 0, scrolling: "no", helpers: { overlay: { locked: false}} }) };