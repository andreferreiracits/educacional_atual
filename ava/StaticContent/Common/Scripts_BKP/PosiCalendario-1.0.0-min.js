var tipoVisualizacao;var cursorDate;var datasource;var prefsDatasource;(function(a){a.fn.posiCalendario=function(v){datasource=v.datasource;prefsDatasource=v.prefsDatasource;function I(U){var V=new Date();V.setFullYear(U.getFullYear(),U.getMonth(),U.getDate());return V}function i(U,V){return U.getDate()==V.Date&&U.getMonth()==V.Month&&U.getFullYear()==V.Year}function Q(U){cursorDate.setMonth(cursorDate.getMonth()+(U=="next"?1:-1));f(U)}function r(U){P.find(".t-nav-fast").hide().fadeIn("fast").html(U)}function F(){var X=[];var V=new Date().getFullYear();X.push("<thead><tr><th colspan='3'>Selecione ano</th></thead><tbody>");for(var W=0;W<3;W++){X.push("<tr>");for(var U=0;U<3;U++){k=W*3+U;X.push("<td><span>");X.push(k-4+V);X.push("</span></td>")}X.push("</tr>")}X.push("</tbody>");h.fadeOut("fast",function(){a(this).show().html(X.join("")).find("td").click(function(){var Y=parseInt(a(this).find("span").text());cursorDate.setFullYear(Y,1,1);r(Y);S()})})}function S(){var W=[];W.push("<thead><tr><th colspan='3'>Selecione mês</th></thead><tbody>");for(var V=0;V<4;V++){W.push("<tr>");for(var U=0;U<3;U++){k=V*3+U;W.push("<td><span>");W.push(R[k].substr(0,3));W.push("</span></td>")}W.push("</tr>")}W.push("</tbody>");h.fadeOut("fast",function(){a(this).show().html(W.join("")).find("td").click(function(){var X=h.find("td").index(this);cursorDate.setMonth(X);z()})})}function z(X){var W=[];W.push("<colgroup><col class='t-sunday' /><col class='t-weekday' span='5' /><col class='t-saturday' /></colgroup><thead><tr>");a.each(E,function(Y,Z){W.push("<th>");W.push(Z);W.push("</th>")});W.push("</tr></thead><tbody>");for(var V=0;V<6;V++){W.push("<tr>");for(var U=0;U<7;U++){W.push("<td><span>&nbsp;</span></td>")}W.push("</tr>")}W.push("</tbody>");h.html(W.join("")).find("td").click(function(){var Z=h.find("td");Z.removeClass("t-selected");a(this).addClass("t-selected");var Y=Z.index(this);c=new Date(data[Y].Year,data[Y].Month,data[Y].Date);cursorDate=I(c);n=true;a.ajax({url:prefsDatasource,type:"post",data:{what:"atualizaPreferencia",titulo:"diaselecionado",valor:data[Y].Year+","+data[Y].Month+","+data[Y].Date}});if(a.isFunction(m)){m.call(P,c)}});f(X);B=true}function N(X){var W=I(cursorDate);W.setHours(12,0,0,0);W.setDate(W.getDate()+(X=="prev"?(-7):7));if(W.getMonth()!=cursorDate.getMonth()){cursorDate=W;f(X)}else{cursorDate=W;f(null)}var V=I(cursorDate);V.setDate(cursorDate.getDate()-cursorDate.getDay());var U=h.find("td").filter(function(Y){var aa=I(V);for(var Z=0;Z<7;Z++){if(i(aa,data[Y])){return true}aa.setDate(aa.getDate()+1)}return false}).addClass("t-selected")}function G(W){var V=I(cursorDate);V.setHours(12,0,0,0);V.setDate(V.getDate()+(W=="prev"?(-1):1));if(V.getMonth()!=cursorDate.getMonth()){cursorDate=V;f(W)}else{cursorDate=V;f(null)}var U=h.find("td").filter(function(X){return i(V,data[X])}).addClass("t-selected")}function t(){if(d){G("prev")}else{if(j){N("prev")}else{Q("prev")}}}function x(){if(d){G("next")}else{if(j){N("next")}else{Q("next")}}}function l(){var U=new Date();U.setHours(0,0,0,0);cursorDate.setHours(0,0,0,0);direction=(U>cursorDate?"next":(U<cursorDate?"prev":null));cursorDate=U;z(direction);h.find("td").filter(function(V){return i(cursorDate,data[V])}).click()}function f(W){var V=false;var U=new Date();W=(W=="next"?"right":(W=="prev"?"left":null));if(W==null){h.hide().fadeIn("slow")}else{h.show("slide",{direction:W},600)}c=null;n=false;data=K.getMonthlyData(cursorDate);h.find("td").each(function(X){if(data[X].Date==1){V=!V}a(this).removeClass("t-selected").find("span").removeClass().addClass(V?"t-this-month":"t-other-month").addClass(i(U,data[X])?"t-today":"").html(data[X].Date)});r(R[cursorDate.getMonth()]+"/"+cursorDate.getFullYear())}var b=new function(){this.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];this.MONTH_NAME=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];this.WEEKDAY_NAME=["D","S","T","Q","Q","S","S"]};var K=new function(){this.getMonthlyData=function(V){var Z=[];var U,ad,aa;var X,ab;var ac=42;X=V.getMonth();ab=V.getFullYear();var W=I(V);W.setDate(1);U=b.DAYS_IN_MONTH[X-1<0?(12+X-1):(X-1)];ad=W.getDay();aa=b.DAYS_IN_MONTH[X]+ad;if(X-1==1&&ab%4==0){U++}if(X==1&&ab%4==0){aa++}for(var Y=0,ae;Y<ad;Y++){Z.push({Date:U-ad+Y+1,Month:(ae=X-1)<0?(12+ae):ae,Year:X-1<0?(ab-1):ab})}for(var Y=ad;Y<aa;Y++){Z.push({Date:Y-ad+1,Month:X,Year:ab})}for(var Y=aa,ae;Y<ac;Y++){Z.push({Date:Y-aa+1,Month:(ae=X+1)>=12?(ae-12):ae,Year:X+1>=12?(ab+1):ab})}return Z}};var g=[];cursorDate=v.cursor?I(v.cursor):new Date();var c=null;var n=false;var j=v.isWeekly?true:false;var d=v.isDaily?true:false;var R=v.monthName||b.MONTH_NAME;var E=v.weekdayName||b.WEEKDAY_NAME;var B=true;var J=v.prevButtonName||"&larr;";var y=v.nextButtonName||"&rarr;";var o=v.todayButtonName||"Hoje";var O=v.monthButtonName||"Mês";var T=v.weekButtonName||"Semana";var u=v.dayButtonName||"Dia";var m=v.onSelection||function(U){};var w=v.onMonth||function(U){};var M=v.onWeek||function(U){};var C=v.onDay||function(U){};var s=v.onPrev||function(U){};var H=v.onNext||function(U){};var q=v.onToday||function(U){};var e=v.imageBaseUrl||"cssimg";var P=this;var L=a(v.selectionNav);g.push("<div id='Calendar' class='t-calendar'>");g.push("<div class='t-header'>");g.push("<a class='t-nav-prev t-link' href='#'><span class='t-icon t-arrow-prev'>&lt;</span></a>");g.push("<a class='t-nav-fast t-link' href='#'></a>");g.push("<a class='t-nav-next t-link' href='#'><span class='t-icon t-arrow-next'>&gt;</span></a>");g.push("</div>");g.push("<table class='t-content' />");g.push("</div>");a(g.join("")).appendTo(P);var h=P.find(".t-calendar .t-content");z();h.find("td").filter(function(U){return i(cursorDate,data[U])}).addClass("t-selected");P.find(".t-nav-prev").click(function(U){U.preventDefault();if(B){Q("prev")}});P.find(".t-nav-next").click(function(U){U.preventDefault();if(B){Q("next")}});P.find(".t-nav-fast").click(function(U){U.preventDefault();B=false;F()});g=[];g.push("<div class='t-selection-nav'>");g.push("<a href='#' class='t-selection-prev t-icon t-nav-prev'>"+J+"</a>");g.push("<a href='#' class='t-selection-next t-icon t-nav-next'>"+y+"</a>");g.push("<a href='#' class='ftr bt menor mleft'>Filtro<span class='t-icon'></span></a>");g.push("<a href='#' class='t-selection-month bt menor mleft'>"+O+"</a>");g.push("<a href='#' class='t-selection-week bt menor mleft'>"+T+"</a>");g.push("<a href='#' class='t-selection-day bt menor mleft'>"+u+"</a>");g.push("<a href='#' class='t-selection-today bt menor mleft'>"+o+"</a>");g.push("<div style='clear: both'></div>");g.push("</div>");a(g.join("")).appendTo(L);var D=L.find(".t-selection-nav");function p(U){a(U,D).removeClass("selected").find("span").remove()}function A(U){a(U,D).addClass("selected").append(a("<span/>").addClass("abadown").append(a("<img />").attr("src",e+"/seta.png")))}D.find(".t-selection-today").click(function(U){U.preventDefault();l();if(a.isFunction(q)){q.call(P,cursorDate)}});D.find(".t-selection-prev").click(function(U){U.preventDefault();if(a.isFunction(s)){s.call(P,cursorDate)}t()});D.find(".t-selection-next").click(function(U){U.preventDefault();if(a.isFunction(H)){H.call(P,cursorDate)}x()});if(j){tipoVisualizacao="W";A(".t-selection-week")}else{if(d){tipoVisualizacao="D";A(".t-selection-day")}else{tipoVisualizacao="M";A(".t-selection-month")}}D.find(".t-selection-month").click(function(U){U.preventDefault();p(".t-selection-week, .t-selection-day");A(".t-selection-month");j=false;d=false;tipoVisualizacao="M";if(a.isFunction(w)){w.call(P,cursorDate)}a.ajax({url:prefsDatasource,type:"post",data:{what:"atualizaPreferencia",titulo:"tipoVisualizacao",valor:tipoVisualizacao}})});D.find(".t-selection-week").click(function(U){U.preventDefault();p(".t-selection-month, .t-selection-day");A(".t-selection-week");j=true;d=false;tipoVisualizacao="W";if(a.isFunction(M)){M.call(P,cursorDate)}a.ajax({url:prefsDatasource,type:"post",data:{what:"atualizaPreferencia",titulo:"tipoVisualizacao",valor:tipoVisualizacao}})});D.find(".t-selection-day").click(function(U){U.preventDefault();p(".t-selection-week, .t-selection-month");A(".t-selection-day");j=false;d=true;tipoVisualizacao="D";if(a.isFunction(C)){C.call(P,cursorDate)}a.ajax({url:prefsDatasource,type:"post",data:{what:"atualizaPreferencia",titulo:"tipoVisualizacao",valor:tipoVisualizacao}})})}})(jQuery);