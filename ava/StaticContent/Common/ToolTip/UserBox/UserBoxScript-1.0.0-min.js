(function(c){c.fn.UserBox=function(e){this.opts=jQuery.extend(c.trocaPapelDefaultOptions,e||{});a(c(this),this.opts)};function a(f,e){c.ajax({url:e.templateUrl,cache:false,dataType:"text/html",success:function(g,i,h){f.html(g);f.find("#userbox-content-rolechange").css("display","");b(f,e)},error:function(g,i,h){PosiLog.logDebug("TrocaPapel-->"+i)}})}function b(f,e){c.ajax({url:e.dataSourceUrl,cache:false,type:"post",dataType:"json",success:function(g,i,h){c("#userbox-papel-corrente").html(g.strPapelCorrente);c("#userbox-last-access").html("&nbsp;"+g.strUltimoAcesso);c("#userbox-photo").attr("src",g.strNomePhoto);if(g.papeis.length>1){c("#userbox-opt-papel").css("display","");c("#userbox-text-papel").css("display","none");c("#userbox-opt-papel").html("");c(g.papeis).each(function(){var j=(this.IdPapel==g.intPapelCorrente)?"selected":"";c("#userbox-opt-papel").append("<option value='"+this.IdPapel+"' "+j+">"+this.strNome+"</option>")})}else{c("#userbox-opt-papel").css("display","none");c("#userbox-text-papel").css("display","");c("#userbox-text-papel").html("");c("#userbox-text-papel").html(g.strPapelCorrente)}d(f,e)},error:function(g,i,h){PosiLog.logDebug("TrocaPapel-->"+i)}})}function d(g,e){c("#userbox-opt-papel").change(function(){var h=this;c.ajax({url:e.setPapelUrl,cache:false,dataType:"text",type:"post",data:{IdPapel:h.value,IdUnidade:0},success:function(i,k,j){if(String.valueOf(i)==String.valueOf(this.value)){c("#userbox-papel-corrente").html("Carregando...");window.location.href="/LMS/MeuEspaco"}else{h.value=String.valueOf(i)}},error:function(i,k,j){PosiLog.logDebug("TrocaPapel-->"+k)}})});c("#userbox-opt-unidade").click=c("#userbox-opt-papel").click;c("#userbox-bt-edit-profile").click(function(h){window.location.href=e.editProfileUrl;h.preventDefault()});var f=100;c("#userbox-content-rolechange").position({my:"top",at:"bottom",collision:"flip",offset:"0 100 0",of:c("#userbox-bt-rolechange")});c("#userbox-close-window").click(function(h){c("#userbox-bt-rolechange").click();h.preventDefault()});c("#userbox-bt-rolechange").toggle(function(h){c("#userbox-content-rolechange").show(f);c("#userbox-bt-rolechange").removeClass("userbox-bt-rolechange");c("#userbox-bt-rolechange").addClass("userbox-bt-rolechange-content-displaying");c("#userbox-content-rolechange").position({my:"top",at:"bottom",collision:"flip",offset:"-30 0 0 0",of:c("#userbox-bt-rolechange")});c("#userbox-content-rolechange").position({my:"left",at:"left",collision:"flip",offset:"0 13 0 0",of:c("#wellcome")});c("#userbox-bt-rolechange").html("&#9650;");h.preventDefault()},function(h){c("#userbox-content-rolechange").hide(f);c("#userbox-bt-rolechange").addClass("userbox-bt-rolechange");c("#userbox-bt-rolechange").removeClass("userbox-bt-rolechange-content-displaying");c("#userbox-bt-rolechange").html("&#9660;");h.preventDefault()})}c.trocaPapelDefaultOptions={dataSourceUrl:"/Home/GetDadosSelecaoPapel",setPapelUrl:"/Home/SetPapel",editProfileUrl:"/",templateUrl:"/Common/UserBox/UserBoxTemplate.html",rootDirUrl:"/Common/UserBox"}})(jQuery);