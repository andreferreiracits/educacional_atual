function Tabela(sFormulario,sTabela,bIniciar,oOrdemPadrao,fRetornoPadrao,fCallBack){var tbl=this;this.version="0.1.0";this.id=sFormulario;this.formulario="form#"+sFormulario;this.tabela=this.formulario+" table#"+sTabela;this.inicia=(bIniciar!=undefined)?bIniciar:false;this.caminho="";this.ordem=(oOrdemPadrao!=undefined)?oOrdemPadrao:new Ordenacao();this.retornar=fRetornoPadrao;this.callBack=fCallBack;this.init=function(){this.caminho=$(this.formulario).attr("action");this.criarElementos();this.criarFuncionalidades();this.criarOrdenacao();$(this.formulario).submit(function(e){$.ajax({url:tbl.caminho,data:$(this).serialize()+"&"+$("#idBanco").parents("form").serialize(),type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(dados,status,xhttp){tbl.carregarTabela(dados)}});tbl.carregar(true);e.preventDefault()});if(this.inicia){$(this.formulario).submit()}};this.criarElementos=function(){var pagina=document.createElement("input");var acao=document.createElement("input");var ordem=document.createElement("input");var viewstate=document.createElement("input");pagina.type="hidden";pagina.id=pagina.name="txtPagina_"+this.id;pagina.value="1";acao.type="hidden";acao.id=acao.name="txtAcao_"+this.id;acao.value="1";ordem.type="hidden";ordem.id=ordem.name="txtOrdem_"+this.id;ordem.value="";viewstate.type="hidden";viewstate.id=viewstate.name="viewState_"+this.id;$(this.formulario).prepend($(pagina));$(this.formulario).prepend($(acao));$(this.formulario).prepend($(ordem));$(this.formulario).append($(viewstate))};this.criarFuncionalidades=function(){$(this.tabela+" > thead > tr > td > input[type=checkbox]").click(function(){var nome="input[type=checkbox][name="+this.id+".Checked]";if($(this).attr("checked")==true){$(nome).attr("checked","checked")}else{$(nome).removeAttr("checked")}})};this.criarOrdenacao=function(){$(this.tabela+" > thead > tr > td > a").each(function(){var ordem="";var caminho=$(this).attr("href");var padrao=new RegExp("ordem=([^&]+)");if(padrao.test(caminho)){ordem=padrao.exec(caminho)[1]}$(this).attr("href","javascript:void(0)");if(ordem!=""){$(this).click(function(){tbl.ordenar(ordem,this)})}})};this.ordenar=function(tipo,objeto){if(tipo==this.ordem.tipo){this.ordem.ascendente=!this.ordem.ascendente}else{this.ordem.tipo=tipo;this.ordem.ascendente=true}this.redesenharOrdenacao(objeto);$("#txtOrdem_"+this.id).val(this.ordem.tipo+","+((this.ordem.ascendente)?0:1));$(this.formulario).submit()};this.redesenharOrdenacao=function(objeto){$(this.tabela+" > thead > tr > td > a").removeClass(Ordenacao.CRESCENTE);$(this.tabela+" > thead > tr > td > a").removeClass(Ordenacao.DECRESCENTE);if(this.ordem.ascendente){$(objeto).addClass(Ordenacao.CRESCENTE)}else{$(objeto).addClass(Ordenacao.DECRESCENTE)}};this.carregarTabela=function(dados){var id=this.id;if($("#txtTotalRegistro_"+id).is("input:hidden")==false){var total=document.createElement("input");total.type="hidden";total.id=total.name="txtTotalRegistro_"+id;total.value="-1";$(this.formulario).prepend($(total))}this.verficiarPagina(dados);this.carregarPaginacao(dados);this.carregarFiltro(dados);this.carregarAcaoMassa();this.carregarLinhas(dados)};this.verficiarPagina=function(dados){var id=this.id;$(dados).each(function(){$("#txtTotalRegistro_"+id).val($(this).attr("total"));tbl.alterarPagina($(this).attr("atual"))})};this.carregarLinhas=function(dados){var tamanhos=[];var corpo=this.tabela+" > tbody";$(dados).find("tbody").each(function(){if($(tbl.tabela).hasClass("scroll")){tamanhos=tbl.adicionarScroll();corpo+=" > tr > td > div > table > tbody"}$(corpo).html($(this).children())});$(corpo+" > tr").each(function(index){if(index%2){$(this).addClass("impar")}$(this).hover(function(){$("div.botoes",this).css("display","block")},function(){$("div.botoes",this).css("display","none")});tbl.carregarAcao(this)});if(this.callBack!=undefined){this.callBack(dados)}};this.adicionarScroll=function(){var cabecalho=this.tabela+" > thead";var corpo=this.tabela+" > tbody";var tr=document.createElement("tr");var td=document.createElement("td");var div=document.createElement("div");var table=document.createElement("table");var tbody=document.createElement("tbody");var tamanhos=[];$(cabecalho+" > tr > td").each(function(){tamanhos.push($(this).css("width"))});table.className="tabela";table.cellSpacing="0";table.cellPadding="0";td.colSpan=this.contarColunas($(cabecalho+" > tr"));table.appendChild(tbody);div.appendChild(table);td.appendChild(div);tr.appendChild(td);$(corpo).html($(tr));return tamanhos};this.carregarPaginacao=function(dados){var resultado=this.formulario+" > div.ferramentas > div.resultado";var paginacao=this.formulario+" > div.ferramentas > div.paginacao";$(resultado).empty();$(paginacao).empty();$(dados).find("tfoot").each(function(){$(paginacao).html($("tr > td#pagina",this).children());$(resultado).html($("tr > td#resultado",this).html())});$(paginacao+" > a").each(function(){var pagina=0;var caminho=$(this).attr("href");var padrao=new RegExp("pagina=(\\d+)");if(padrao.test(caminho)){pagina=padrao.exec(caminho)[1]}$(this).attr("href","javascript:void(0)");if($(this).attr("class")!="selecionado"&&pagina>0){$(this).click(function(){tbl.trocarPagina(pagina)})}})};this.trocarPagina=function(pagina){$("#txtAcao_"+this.id).val("paginar");$("#txtPagina_"+this.id).val(pagina);$(this.formulario).submit()};this.alterarPagina=function(pagina){$("#txtAcao_"+this.id).val("paginar");$("#txtPagina_"+this.id).val(pagina)};this.carregarAcao=function(linha){var botoes=$("div.botoes > a",linha);botoes.each(function(index){var botao=$(this);var link=$(this).attr("href");if(botao.is(".normal")){}else{if(botao.is(".funcao")){botao.click(function(){setTimeout(link,1)});botao.attr("href","javascript:void(0)")}else{botao.click(function(){tbl.executarAcao($(this).html(),link,tbl.retornarAcao)});botao.attr("href","javascript:void(0)")}}})};this.executarAcao=function(acao,link,retorno){$("#txtAcao_"+this.id).val(acao);$.ajax({url:link,data:$(this.formulario).serialize()+"&"+$("#idBanco").parents("form").serialize(),type:"POST",success:function(data){tbl.retornarAcao(acao,data)}})};this.retornarAcao=function(acao,dados){if(this.retornar!=undefined){this.retornar(acao,dados)}};this.carregarFiltro=function(dados){var filtro=this.formulario+" > div.ferramentas > div.filtros";$(this.formulario+" > div.ferramentas > div.slc#filtro").combo({close:"fechar",onOpen:function(){},onExecute:function(){tbl.executarFiltro()},onClose:function(){tbl.limparFiltro()}});$(dados).find("thead").each(function(index){$(filtro).empty();$(filtro).html($("tr > td",this).html())});$("span.botaoFiltro").each(function(index){var id=$(this).attr("id");$("a.botaoFechar",this).attr("href","javascript:void(0)").click(function(){tbl.removerFiltro(id)})})};this.executarFiltro=function(){$("#txtAcao_"+this.id).val("filtrar");$(this.formulario).submit()};this.executarOrdem=function(){$("#txtAcao_"+this.id).val("ordenar");$(this.formulario).submit()};this.TrocaPeriodo=function(){$("#txtAcao_"+this.id).val("periodo");$(this.formulario).submit()};this.removerFiltro=function(id){var hidden=$("#txtFiltros");var campo=id.split("_")[1];var array=eval(hidden.val());var filtros=new Array();for(i=0;i<array.length;i++){if(array[i].campo!=campo){filtros.push(new Filtro(array[i]))}}name=id.replace("filtro_","");if($("#"+name).is("input:text")){$("#"+name).val("")}else{if($("#"+name).is("input:radio")||$("#"+name).is("input:checkbox")){$("#"+name).attr("checked","")}else{if($("#"+name).is("select")){$("#"+name).get(0).selectedIndex=0;$("#"+name).trigger("change")}}}$("#"+id).remove();hidden.val("["+filtros+"]");tbl.recarregarTabela()};this.limparFiltro=function(id){var caminho=this.formulario+" > div.ferramentas > div.slc#filtro"};this.carregarAcaoMassa=function(){$(this.formulario+" > div.ferramentas > div.slc#acao").combo({close:"fechar",onOpen:function(){},onClose:function(){}});$("#acao > div > a").each(function(index){var acao="";var caminho=$(this).attr("href");var padrao=new RegExp("acao=([^&]+)");if(padrao.test(caminho)){acao=padrao.exec(caminho)[1]}$(this).attr("href","javascript:void(0)");if(acao!=""){$(this).click(function(){tbl.executarAcaoMassa(acao)})}$(this).parent().hide();$("a",$(this).parent().parent()).removeClass("selecionado")})};this.executarAcaoMassa=function(acao){$("#txtAcao_"+this.id).val(acao);$.ajax({url:tbl.caminho,data:$(tbl.formulario).serialize()+"&"+$("#idBanco").parents("form").serialize(),type:"POST",success:function(dados){tbl.retornarAcaoMassa(acao,dados)}})};this.retornarAcaoMassa=function(acao,dados){if(this.retornar!=undefined){this.retornar(acao,dados)}this.recarregarTabela()};this.recarregarTabela=function(){$("#txtAcao_"+this.id).val("recarregar");$(this.formulario).submit()};this.limpar=function(){$(this.tabela+" > thead > tr > td > input[type=checkbox]").each(function(){$(this).attr("checked","")});$(this.tabela+" > tbody").html($("<tr><td></td></tr>"))};this.carregar=function(exibir){this.limpar();if(exibir){var linha=document.createElement("tr");var coluna=document.createElement("td");coluna.className="carregando";try{coluna.colSpan=this.contarColunas($(this.tabela+" > thead tr"))}catch(e){}linha.appendChild(coluna);$(this.tabela+" > tbody").html($(linha))}};this.contarColunas=function(linha){var colunas=0;$(linha).children().each(function(index){var valor=$(this).attr("colspan");colunas+=(valor==undefined)?1:valor});return colunas};this.tratarErros=function(dados){};$(document).ready(function(){tbl.init()})};